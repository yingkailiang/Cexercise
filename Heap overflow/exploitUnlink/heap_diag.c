#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int heap_fill(char *str)
{
    //buffer1 is the buffer we are going to overflow, buffer2 is our target
    char *buffer1, *buffer2;
    buffer1 = (char *) malloc(12);
    buffer2 = (char *) malloc(584);

    //copy our malicious data into the buffer
    //strcpy doesn't work because our data has 0's
    //strcpy(buffer1, str); 
    memcpy(buffer1, str, 600);
    free(buffer2);
    return 1;
}

int main(int argc, char **argv)
{
    FILE *badfile;
    char str[600];
    
    badfile = fopen("diagfile", "r");
    fread(str, sizeof(char), 600, badfile);
    heap_fill(str);

    printf("Returned Properly\n");
}
